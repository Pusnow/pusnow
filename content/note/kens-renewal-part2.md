---
title: "KENS 리뉴얼 Part 2: 개발 환경"
date: 2022-11-16
lang: ko-kr
tags:
    - system
draft: true
---

## KENS 개발 환경

[기존 KENS 시스템](https://github.com/ANLAB-KAIST/KENSv3/tree/v3.0)은 과제를 수행하기 위한 개발 환경을 셋업하는 것이 학생들에게 조금 까다로웠다.
KENS의 빌드 시스템은 순수 Makefile 이루어져 있고, 빌드시 [GoogleTest](https://google.github.io/googletest/) 라이브러리를 설치해 주어야 하기 때문에, C/C++을 처음 혹은 두번째로 사용하는 학생들은 이 둘에 익숙하지 못하다.
따라서, 학생들 중 상당수가 과제를 시작하는데 어려움을 겪고 관련 질의응답도 많이 있었다.

이 문제의 질의응답이 어려운 학생들의 개발 환경이 매우 다양하다는 점이다.
많은 학생들이 리눅스가 아닌 macOS와 Windows를 사용하고 있고, 리눅스를 사용하더라도 배포판, GCC 및 GoogleTest 버전 등 개발환경이 다양하기 때문이다.
또, 학생들이 질문을 할 때부터 필요한 정보를 제공하기 않아 여러번 질문을 해야 하는 경우도 많아 조교들의 부담도 컸었다.

솔루션 파일도 빌드 시스템을 복잡하게 하는 요인이었다. KENS의 테스트(혹은 채점) 과정은 학생들이 작성한 TCP 구현과 조교가 작성한 TCP 구현이 호환되는 가를 확인한다.
여기서 조교가 작성한 구현의 소스코드는 학생들에게 공개되면 안되기 때문에, 컴파일된 바이너리의 형태로 제공되는데, 간혹 이 바이너리가 호환 문제를 일으키는 경우도 있었다.

과거에는 이 문제를 해결하기 위해, 모든 소스코드와 라이브러리가 설치된 VirtualBox 디스크 이미지를 배포하기도 했었다.
이는 학생들이 사용하기도 어렵고, 디스크 이미지의 크기가 1GB 정도이기 때문에 배포에도 부담이 있었다.

따라서, 학생들이 쉽게 과제를 시작할 수 있는 개발 환경을 만드는 것이 필요했다.
이 글에서는 KENS의 빌드 시스템이 어떻게 변했고, 그 결과를 공유한다.

## 사용하기 쉬운 빌드 시스템

KENS의 빌드시스템은 단순한 Makefile로 구성되어 있다.
간단한 구성이지만 이 Makefile에는 여러 문제가 있었는데, 대표적으로 빌드 방법과 사용법이 조금 특이한 커멘드를 사용해야 하고 `configure` 스크립트가 없어 GoogleTest 라이브러리 설치 유무를 판단하지 못했다.
이 문제를 모두 해결하도록 Makefile을 수정할 수도 있지만, 새로운 빌드 시스템을 사용하여 빌드 스크립트를 다시 작성하여 현대적 빌드 시스템의 이점을 수용하기로 결정했다.

다양한 빌드 시스템이 있지만, KENS를 위해서는 CMake를 사용하기로 결정했다.
CMake는 비교적 사용 방법이 간단하고 (automake 대비), Windows/macOS 지원도 잘 동작하며, 다양한 IDE 프로젝트 파일(Visual Studio, Xcode) 생성 기능도 가지고 있기 때문에, KENS 처럼 초심자가 다양한 환경을 주로 사용하는 프로젝트에 적합하다고 판단했다.

CMake의 장점 중 하나는 생각보다 많은 프로젝트가 사용하기 쉽다는 것이고, CMake를 사용하는 프로젝트라면 쉽게 다운로드/링크 빌드 스크립트 작성할 수 있다는 점이다.
GoogleTest도 CMake를 사용하는 프로젝트이기 때문에, KENS 또한 CMake 빌드 스크립트로 [자동으로 GoogleTest를 다운로드하고 링크](https://github.com/ANLAB-KAIST/KENSv3/blob/af43e908b2977e06db5466367c9ef91bb8656525/CMakeLists.txt#L133-L144)하도록 했다.
또, 솔루션 바이너리 파일도 이 기능을 활용하여 CMake 스크립트로 작성하여 자동으로 개발 환경(운영체제, 컴파일러)에 맞는 솔루션을 다운로드 할 수 있도록 하였다.
결과적으로 인터넷에만 연결되어 있다면 GoogleTest와 솔루션 바이너리 파일이 자동으로 설치/링크되기 때문에, 학생들은 따로 신경쓰지 않아도 쉽게 과제를 시작할 수 있게 되었다.

CMake 도입은 학생들의 과제 수행에 많은 부분을 차지하는 디버깅에도 추가적인 이점을 가져왔다.
CMake의 IDE 프로젝트 파일 생성 기능을 사용하면 강력한 디버깅 기능이 있는 IDE(Visual Studio, Xcode)에서 과제를 수행할 수 있게 된다.
또, 직접적인 프로젝트 생성은 없지만, [플러그인](https://marketplace.visualstudio.com/items?itemName=ms-vscode.cmake-tools)을 활용하면 Visual Studio Code에서도 디버깅 기능을 사용할 수 있다.
이런 IDE를 이용한 개발은 CLI 개발과 달리 단순 클릭 만으로 브레이크 포인트, 스택 트레이스 등의 기능을 쉽게 사용할 수 있게 하므로, GDB등의 CLI 기반의 디버거에 익숙하지 않은 학생들도 쉽게 디버깅을 할 수 있게 되었다.

CMake로의 전환은 수업에 많은 도움이 되었다.
기존에 많은 학생들이 겪었던 빌드 관련 질의응답은 대부분 사라졌으며, 학생들이 디버거를 활용하여 쉽게 버그를 고칠 수 있게 돼 과제의 본래 목적인 TCP 스택 구현에 집중할 수 있게 되었다.

## 솔루션 바이너리 배포 시스템


## 윈도우 호환 레이어


## 결론
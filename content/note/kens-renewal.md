---
title: KENS 리뉴얼
date: 2022-08-12
lang: ko-kr
tags:
    - system
draft: true
---

* [Source code available](https://github.com/ANLAB-KAIST/KENSv3)

## KENS

KAIST 전산망 개론 수업에서는 KENS (KAIST Educational Network System)라는 네트워크 교육용 시스템을 활용한다.
학생들은 KENS를 이용하여 기초적인 TCP 스택을 구현하는 과제를 수행하며, 이 과제는 전체 수업 과정 중에 상당한 부분을 차지한다.
하지만, 내가 조교 활동을 준비하고 있을 때(2020년 여름)는 KENS 과제에 여러 문제가 누적되어 있었으며, 이 글에서는 조교 활동 및 준비 기간(2020년 여름 ~ 2022년 여름)동안, KENS가 개선된 내용을 일부 소개한다.

조교 활동을 하면서 많은 부분이 개선되었지만, 이 글에서는 다음 내용들을 소개한다.

* 빠르고 쉬운 빌드 시스템
* 쉽고 안전한 메모리 관리 시스템
* 새로운 과제
* 다양한 조교 도구
* 지속가능한 에코 시스템 구축

## 빠르고 쉬운 빌드 시스템

KENS를 처음 개선하기 시작했을 때, 가장 시급한 문제는 빌드 시스템이었다.
[기존 시스템](https://github.com/ANLAB-KAIST/KENSv3/tree/v3.0)에서는 순수 Makefile로 빌드 시스템이 구성되어 있으며,
GoogleTest 의존성을 사용자가 알아서 해결해 주었어야 했다.
특히, GoogleTest는 Debian/Ubuntu 환경에서도 설치 방법이 독특하여, 많은 학생들이 설치에 어려움을 겪었고, 경우에 따라서는 환경 구성에 수일이 걸리는 학생도 있었다.

따라서, 사용하기 쉽고 외부 의존성을 최소화 할 수 있는 CMake를 활용하기로 결정하고, 모든 Makefile을 CMake로 포팅하였다.
GoogleTest를 사용하기 위해서 KENS는 더이상 시스템 라이브러리에 의존하지 않고, GoogleTest 공식 Git 저장소에서 바로 다운로드, 빌드 및 컴파일 하도록 변경하였다.

CMake의 도입은 여러 추가적인 장점을 가져오는데, 그 중 가장 유용했던 것은 다양한 제네레이터를 지원한다는 것이다.
특히, 기존 시스템과 달리 Xcode 혹은 Visual Studio와 같은 IDE 제네레이터를 활용하면, 학생들이 익숙한 시스템에서 과제를 수행할 수 있게 되었다.
이들 IDE의 코드 컴플리션 및 디버거은 많은 학생들이 편하게 개발 및 디버깅을 할수록 큰 도움이 되었다.

결과적으로, CMake 도입은 큰 성공이었다.
기존에는 학생들 개발 환경에 셋업관련 질의응답에 많은 리소스가 소요되었고, 마지막 수단으로 Docker 컨테이너 이미지나 Virtualbox 디스크 이미지를 배포하기도 하였다.
CMake 도입으로 학생들의 빌드 관련 질문은 거의 사라졌고, 학생 편의에가 크게 향상되었다.

## 쉽고 안전한 메모리 관리 시스템

학생들이 개발환경 구축 다음으로 가장 많이 겪는 문제는 메모리 관련 버그였다.
특히 기존 KENS 소스코드는 모든 부분에서 raw 포인터를 활용하고 모든 리소스를 수동으로 할당 및 해제해 주어야 되어씩 때문에,
학생들이 메모리 관리 코드를 작성할 때 빈번하게 실수를 하게 된다.
더욱이 메모리 관련 오류를 많이 경험해 보지 않은 학생들은 버그들이 왜, 어디서 발생하는 지, 어떻게 수정해야 하는 지를 잘 모르기 때문에,
이 오류들을 잘 해결해 주는 것은 기존 조교 업무에서 꽤 중요한 일이었다.

이 문제들을 근본적으로 해결하기 위해서는 자동화된 메모리 관리 시스템을 화용하면 되는데, C++에서는 스마트 포인터가 이 역할을 해준다.
하지만, 스마트 포인터의 원리상 각 객체의 소유권을 엄밀하게 드러내야 한다.
문제는 기존 KENS 코드베이스에서는 구현상 상당 부분에서 소유권이 애메하게 처리된 부분이 많고 묵시적으로 공유하는 포인터 등이 많아서 이를 모두 바꾸는 것은 쉬운 일이 아니었다.
당시 수업을 앞두고 시간이 촉박한 상황이었기 때문에, 한번에 모두 스마트 포인터로 전환하는 것은 포기하고 학생들이 사용하는 인터페이스 부분부터 전환을 시작하여, 이벤트 시뮬레이터, 모듈 구조, 바이너리 솔루션 등으로 하나씩 처리하기로 하였다.

### 사용자 인터페이스
